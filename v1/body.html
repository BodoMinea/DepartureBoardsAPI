<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js" integrity="sha256-yNbKY1y6h2rbVcQtf0b8lq4a+xpktyFc3pSYoGAY1qQ=" crossorigin="anonymous"></script>
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.css" integrity="sha256-R91pD48xW+oHbpJYGn5xR0Q7tMhH4xOrWn1QqMRINtA=" crossorigin="anonymous" />
            <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css"/>
            <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/css/select2.min.css" integrity="sha256-xJOZHfpxLR/uhh1BwYFS5fhmOAdIRQaiOul5F/b7v3s=" crossorigin="anonymous" />
            <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/js/select2.min.js" integrity="sha256-FA14tBI8v+/1BtcH9XtJpcNbComBEpdawUZA6BPXRVw=" crossorigin="anonymous"></script>
            <div class="container">
                <center><h1>Alegerea stației</h1></center>
                <div class="alert alert-primary" role="alert">
                  Puteți alege o stație direct de pe hartă, căutând în caseta de filtrare, sau căutând în caseta de filtrare și apoi orientându-vă pe hartă către stația corectă. Direcțiile diferite ale aceleiași linii opresc în stații diferite.
                </div>
                <center><select><option value="0">Selectați o stație!</option></select></center><br>
                <div id="map" style="width: 100%; height: 500px;"></div><br>
                <center><button class="btn btn-success" id="save" disabled="disabled">Salvare</button></center>
            </div>
            <script type="text/javascript">
                var mymap = L.map('map').setView([44.43225,26.10626], 11.5);
                var layer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    maxZoom: 17
                }).addTo(mymap);
                function createCircleMarker( feature, latlng ){
                  let options = {
                    radius: 4,
                    fillColor: "lightgreen",
                    color: "black",
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                  }
                  return L.circleMarker( latlng, options );
                }
                var cached;
                mymap.on('popupopen', function(e) {
                  $('#save').removeAttr('disabled');
                  var marker = e.popup._source;
                  cached = marker.feature.properties.stop_id;
                });
                (function(){
                    var originalInitTile = L.GridLayer.prototype._initTile
                    L.GridLayer.include({
                        _initTile: function (tile) {
                            originalInitTile.call(this, tile);

                            var tileSize = this.getTileSize();

                            tile.style.width = tileSize.x + 1 + 'px';
                            tile.style.height = tileSize.y + 1 + 'px';
                        }
                    });
                })();
                $('select').on('change',function(){
                    if($('select').val()!=0){
                        $('#save').removeAttr('disabled');
                        cached = $('select').val();
                    }
                })
                $('#save').on('click',function(){
                    $.get('/change?id='+cached,function(datax){
                        if(datax=="OK"){
                            toastr.success('Configurarea a fost actualizată!');
                        }else{
                            toastr.error('A apărut o eroare!');
                        }
                    })
                })
                $.get('https://cdn.jsdelivr.net/gh/BodoMinea/DepartureBoardsAPI@master/v1/stations.json',function(data){
                    geojsonFormattedLocations = data.map(function(location) {
                        return {
                            type: 'Feature',
                            geometry: {
                            type: 'Point',
                                coordinates: [location.lng, location.lat]
                            },
                            properties: {
                                "name":location.name,
                                "stop_id":location.id
                            }
                        };
                    });
                    L.geoJSON( geojsonFormattedLocations, {
                        pointToLayer: createCircleMarker,
                        onEachFeature: function (feature, layer) {
                            $('select').append('<option value="'+feature.properties.stop_id+'">'+feature.properties.name+'</option>');
                            layer.bindPopup('<center><h5>'+feature.properties.name+'</h5></center>');
                          }
                      }).addTo( mymap );
                    $('select').select2();
                })
            </script>
